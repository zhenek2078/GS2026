**ExchangeX** - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–µ–π Nexora Systems. –° –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞ –≤ 2025 –≥–æ–¥—É –æ–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

---

### üîì Vuln 1 ‚Äî SQL Injection

#### –û–ø–∏—Å–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

–í –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ SQL-–∑–∞–ø—Ä–æ—Å:

```cpp
std::string query =
    "SELECT COUNT(*) FROM users WHERE username = '" + username + "' AND password = '" + password + "';";
```

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —É—è–∑–≤–∏–º—ã–º –∫ **SQL-–∏–Ω—ä–µ–∫—Ü–∏—è–º**, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å SQL-–∫–æ–¥ –≤ –∑–Ω–∞—á–µ–Ω–∏—è `username` –∏–ª–∏ `password`, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ–±—Ö–æ–¥—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π payload –≤ –ø–æ–ª–µ –ª–æ–≥–∏–Ω–∞:

```
AUTHadmin' OR 1=1 -- \0password
```

–≠—Ç–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç SQL-–∑–∞–ø—Ä–æ—Å –≤:

```sql
SELECT COUNT(*) FROM users WHERE username = 'admin' OR 1=1 -- ' AND password = 'password';
```

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É—Å–ª–æ–≤–∏–µ `OR 1=1` –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–æ, –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –Ω–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –ø–æ–¥ –ª—é–±—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

### Path Vuln 1 

–î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π** (`prepared statements`) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```cpp
const char* query = "SELECT COUNT(*) FROM users WHERE username = ? AND password = ?";
```

–î–∞–ª–µ–µ —á–µ—Ä–µ–∑ `MYSQL_BIND` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `username` –∏ `password` –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∑–∞–ø—Ä–æ—Å–∞. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É MySQL –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –∏—Ö –∫–∞–∫ **–¥–∞–Ω–Ω—ã–µ**, –∞ –Ω–µ –∫–∞–∫ —á–∞—Å—Ç—å SQL-–∫–æ–¥–∞. –î–∞–∂–µ –µ—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–µ—Ä–µ–¥–∞—Å—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –≤–≤–æ–¥, –æ–Ω –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, –∞ –Ω–µ –∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä SQL.

–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –≤ –¥–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ –≤—Ö–æ–¥–∞.


---

### üß® Vuln 2 ‚Äî Negative Trade Amount:

–£—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ—Ä–≥–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ `process_trade`, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–∞–∂–∏ –∞–∫—Ç–∏–≤–∞:

```cpp
std::shared_ptr<Active> asset = *it;
asset->update_price();
double price = is_buy ? asset->get_ask_price() : asset->get_bid_price();
double total_cost = price * amount;
```

–§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ `amount` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) –≤—Å–µ–≥–¥–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ. –û–¥–Ω–∞–∫–æ —Å–µ—Ä–≤–µ—Ä **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–Ω–∞–∫ –∑–Ω–∞—á–µ–Ω–∏—è** `amount`, –ø—Ä–∏—Ö–æ–¥—è—â–µ–≥–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
BUY AAPL -100
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:

- `total_cost` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º.
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è**, –≤–º–µ—Å—Ç–æ —É–º–µ–Ω—å—à–µ–Ω–∏—è.
.

### Patch Vuln 2:

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `process trade`:

```cpp
if (amount < 0) {  
    send_response("ERROR_TRADE_TOO_SMALL");
    return;
}
```

–≠—Ç–æ—Ç –ø–∞—Ç—á –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –Ω–∞ —Ä–∞–Ω–Ω–µ–º —ç—Ç–∞–ø–µ.


---

### Vuln 3 : SC attak

–í —Å–µ—Ä–≤–∏—Å–µ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º –∞–∫—Ç–∏–≤–æ–º –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –î–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∫–æ–º–∞–Ω–¥–∞ `DELG` 

```cpp
 else if (request.substr(0, 4) == "DELG") {
    std::string content = request.substr(5);
    std::istringstream stream(content);
    std::string to_user, asset;
    double amount;

    if (!(std::getline(stream, to_user, '|') &&
          std::getline(stream, asset, '|') &&
          (stream >> amount))) {
        send_response("ERROR_DELEGATE_FORMAT");
        return;
    }

    std::string query =
        "INSERT INTO user_assets (user_id, asset_anagram, amount) "
        "VALUES ((SELECT id FROM users WHERE username = '" + to_user + "'), '" + asset + "', " + std::to_string(amount) +
        ") ON DUPLICATE KEY UPDATE amount = amount + " + std::to_string(amount) + ";";

    if (mysql_query(db_, query.c_str()) == 0) {
        send_response("DELEGATION_ACCEPTED");
    } else {
        send_response("ERROR_DELEGATION_FAILED");
    }
}
```

–û–¥–Ω–∞–∫–æ –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ç–æ, –∫–æ–º—É –∏–º–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç –∞–∫—Ç–∏–≤, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∞–∫—Ç–∏–≤ **—Å–µ–±–µ** —Ç–µ–º  —Å–∞–º—ã–º –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–≤ –µ–≥–æ

```txt
DELG user META 10
```

### Path Vuln 3:

–î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∞–∫—Ç–∏–≤ —Å–µ–±–µ

```cpp
if(to_user == username_){
    send_response("ERROR_DELEGATE_FORMAT");    
    return;
}
```
---

### Vuln 4 float mount:
#### –û–ø–∏—Å–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:
–í —Å–∏—Å—Ç–µ–º–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∞–∫—Ç–∏–≤–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ –¥—Ä–æ–±–Ω—ã—Ö –¥–æ–ª–µ–π –∞–∫—Ç–∏–≤–∞ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, **0.00000001**  BTC. –ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Ç–æ—Ä–≥–æ–≤–∞—Ç—å —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é. –û–¥–Ω–∞–∫–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ **—Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏** –∏ —É—á–µ—Ç–∞ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ç–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Ä—ã–Ω–∫–æ–º.
```cpp
void process_trade(const std::string& params, bool is_buy) {
    if (username_.empty()) {
        send_response("ERROR_NO_USER");
        return;
    }

    std::istringstream stream(params);
    std::string asset_anagram;
    double amount;

    if (!(stream >> asset_anagram >> amount)) {
        send_response("ERROR_INVALID_FORMAT");
        return;
    }

    auto it = std::find_if(active_assets.begin(), active_assets.end(),
        [&asset_anagram](const std::shared_ptr<Active>& asset) {
            return asset->get_anagram() == asset_anagram;
        });

    if (it == active_assets.end()) {
        
        send_response("ERROR_ASSET_NOT_FOUND2");
        return;
    }
    std::shared_ptr<Active> asset = *it;
    asset->update_price();
    double price = is_buy ? asset->get_ask_price() : asset->get_bid_price();
    double total_cost = price * amount;
    ...
}
```

–ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ —Å–æ–≤–µ—Ä—à–∞—Ç—å –º–∏–∫—Ä–æ—Å–¥–µ–ª–∫–∏ –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏–µ –æ–±—ä—ë–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `0.00000001`), –ø—Ä–∏ —ç—Ç–æ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—è —Å–ø—Ä–æ—Å –∏ –ø—Ä–æ–≤–æ—Ü–∏—Ä—É—è —Ä–æ—Å—Ç —Ü–µ–Ω—ã –∞–∫—Ç–∏–≤–∞. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–º—É –∑–∞–≤—ã—à–µ–Ω–∏—é ask_price –∏ bid_price, —Ç–∞–∫ –∫–∞–∫ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã (update_price) —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è asset_demand.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤, –≤—ã–∑—ã–≤–∞—é—â–µ–π –∏—Å–∫–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω:
```
BUY META 0.00000001
SELL META 0.00000001
```

### Patch Vuln 4:



#### 1 –í–∞—Ä–∏–∞–Ω—Ç
–ß—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å —Ä—ã–Ω–æ–∫ –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ–æ–±—ä–µ–º—ã, –º–æ–∂–Ω–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫—É–ø–∞—Ç—å –Ω–µ —Ü–µ–ª—ã–µ –∞–∫—Ç–∏–≤—ã:
```cpp
if(std::floor(amount) != amount){
    send_response("ERROR_SELL_NOWHOLE_ACTIVE");
    return;
}
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —ç—Ç–æ–≥–æ –ø–∞—Ç—á–∞ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –¥—Ä–æ–±–Ω—ã–º –∫–æ–ª–ª–∏—á–µ—Ç—Å–≤–æ–º –∞–∫—Ç–∏–≤–æ–≤ –±—É–¥—É—Ç –æ—Ç–º–µ–Ω–µ–Ω—ã, –∞ –∑–Ω–∞—á–∏—Ç:
- –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –≤–æ–∑–º–æ–∂–Ω—ã **—Ç–æ–ª—å–∫–æ —Å —Ü–µ–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∞–∫—Ç–∏–≤–æ–≤**,
- –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —á–µ—Ä–µ–∑ –¥—Ä–æ–±–Ω—ã–µ –æ–±—ä–µ–º—ã,
- –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ü–µ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤—ã–º.


#### 2 –í–∞—Ä–∏–∞–Ω—Ç

–û–¥–Ω–∞–∫–æ –º–æ–∂–Ω–æ –ø–æ–π—Ç–∏ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–º –ø—É—Ç–µ–º, –∞ –∏–º–µ–Ω–Ω–æ - –æ–∫—Ä—É–≥–ª–∏—Ç—å amount –≤–Ω–∏–∑.

```
amount = std::floor(amount);  
```

–í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ, –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –æ–∫—Ä—É–≥–ª—è—Ç—Å—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ –∫ –º–∏–Ω—É—Å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏. 

–¢–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ: –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ `process_trade` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `update_user_balance`. –û—Ç –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±—É–¥–µ—Ç—Ç –∑–∞–≤–∏—Å–µ—Ç—å, —É—Å–ø–µ—à–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –∏–ª–∏ –Ω–µ—Ç

```cpp
if (update_user_balance(is_buy ? -total_cost : total_cost)) {
    update_asset_volume(asset_anagram, is_buy ? -amount : amount);
    save_user_assets_to_db(); 
    send_response("TRADE_SUCCESS");
} else {
    send_response("ERROR_TRANSACTION_FAILED");
}

–°–∞–º–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```cpp
bool update_user_balance(double amount) {
    std::string query =
        "UPDATE users SET balance = balance + " + std::to_string(amount) +
        " WHERE TRIM(username) LIKE TRIM('" + username_ + "%') OR TRIM(username) = TRIM('" + username_ + "');";
    if (mysql_query(db_, query.c_str()) != 0) {
        std::cerr << "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: " << mysql_error(db_) << std::endl;
        return false;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã —Å—Ç—Ä–æ–∫–∏
    if (mysql_affected_rows(db_) > 0) {
        return true;
    }

    return false;
}
```
–ó–¥–µ—Å—å –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `mysql_affected_rows(db_) > 0` . –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ–Ω–µ—Ç 1 –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–¥ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å. –í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ amount –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 0, —Ç–æ `mysql_affected_rows` –≤–µ—Ä–Ω–µ—Ç 0 , –∞ –∑–Ω–∞—á–∏—Ç `update_user_balance` –≤–µ—Ä–Ω–µ—Ç `false`, –∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ç–∞–∫—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è

---