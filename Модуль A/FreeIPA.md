# FreeIPA
## Оглавление
- [Полезные ссылки](#полезные-ссылки)
- [Установка FreeIPA сервер](#установка-freeipa-сервер)
- [Ввод ПК в домен](#ввод-пк-в-домен)
- [Группы и пользователи](#группы-и-пользователи)
- [Парольная политика](#парольная-политика)
- [Правила HBAC](#правила-hbac)
## Полезные ссылки
### Все про FreeIPA:
https://docs.altlinux.org/ru-RU/domain/11.0/html/freeipa/password-policy.html
### Документация к развертыванию DC FreeIPA на Astra Linux:
https://wiki.astralinux.ru/pages/viewpage.action?pageId=27362143
### Документация к вводу Astra Linux в домен FreeIPA:
https://wiki.astralinux.ru/pages/viewpage.action?pageId=60359750
## Установка FreeIPA сервер
### Графика:
Установка пакета:
```
sudo apt install fly-admin-freeipa-server
```
Запуск графического интерфейса:
```
sudo fly-admin-freeipa-server
```
Для инициализации вводим:
- имя домена
- имя ПК
- пароль админа домена
- в расширенных настройках выбираем "Настроить центр сертификации"
Нажимаем ***"Создать"***.
В итоге получаем ссылку на веб-интерфейс.
Переходим в браузере по ссылке, авторизуемся под созданным админом домена.
### Консоль:
Установка пакета:
```
sudo apt install astra-freeipa-server
```
Инициализация домена:
```
sudo astra-freeipa-server -n <короткое_имя_сервера> -d <имя_домена>
```
## Установка центра сертификации
Подключаем репозиторий:
```
echo "deb https://dl.astralinux.ru/astra/frozen/2.12_x86-64/2.12.46/repository stable main contrib non-free" | sudo tee -a /etc/apt/sources.list
sudo apt update
```
Удаляем python-pki:
```
sudo dpkg -r --force-depends python-pki
```
Устанавливаем dogtag-pki:
```
sudo apt install dogtag-pki
```
Отключаем подключенный репозиторий и снова обновляем кэш пакетов:
```
sudo apt update
```
Добавляем ЦС к инициализированному серверу:
```
sudo ipa-ca-install
sudo ipa-kra-install
sudo ipa-server-upgrade
```
Если инициализируем одновременно с dogtag:
В графическом интерфейсе открываем расширенные настройки и выбираем "Настроить центр сертификации".
В консоли:
```
sudo astra-freeipa-server -o --dogtag
```
## Ввод ПК в домен
Прописываем DNS сервер:
```
nano /etc/resolv.conf
  search ipadomain0.ru
  nameserver <IP-адрес КД>
  nameserver 77.88.8.8
sudo systemctl restart networking
```
### Графика:
Ставим пакет:
```
sudo apt install fly-admin-freeipa-client
```
Ввод в домен:
В Astra Linux Special Edition 1.8: "Пуск" -> "Параметры" -> "Клиент и сервер"  -> "Настройка FreeIPA клиент Fly".
В более ранних обновлениях: "Пуск" -> "Панель управления" -> "Сеть"  -> "Настройка FreeIPA клиент Fly".
Ввести имя домена, логин и пароль администратора домена, нажать "Подключиться".
### Консоль:
Ставим пакет:
```
sudo apt install astra-freeipa-client
```
Ввод в домен:
```
sudo astra-freeipa-client -d ipadomain.ru
```
## Группы и пользователи
### Создание групп в домене
В веб-интерфейсе переходим в "Идентификация" -> "Группы" -> "Добавить". Указываем имя группы и нажимаем "Добавить".
### Создание пользователей в домене
В веб-интерфейсе переходим в "Идентификация" -> "Пользователи" -> "Добавить". Указываем:
- имя УЗ
- имя пользователя
- фамилия пользователя
- ID группы
- пароль
Нажимаем "Добавить".
## Парольная политика
В веб-интерфейсе переходим в "Политика" -> "Политика паролей". Выбираем дефолтную или создаем новую. В новой указываем к какой группе будет применяться и вводим приоритет (чем меньше число, тем выше приоритет). Затем открываем политику и указываем необходимые параметры, нажимаем "Сохранить".
## Правила HBAC
